<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Everyone's a Critic - The Why And How of Code Review</title>

  <meta name="description"
        content="A presentation on why and how to do code review for Drupal">
  <meta name="author" content="Malcolm Young">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style"
        content="black-translucent">

  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="../css/reveal.css">
  <link rel="stylesheet" href="../css/theme/malcomio.css">

  <!-- Theme used for syntax highlighting of code -->
  <link rel="stylesheet" href="../lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    var print = window.location.search.match(/print-pdf/gi);

    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = print ? '../css/print/pdf.css' : '../css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]><script src="../lib/js/html5shiv.js"></script><![endif]-->
</head>

<body>

<div class="reveal">

  <!-- Any section element inside of this container is displayed as a slide -->
  <div class="slides">
    <section data-markdown data-background-color="#fff">
      <script type="text/template">
        # Everyone's A Critic
        ## The Why And How of Code Review

        Malcolm Young  
        Senior Software Engineer  
        <img src="../images/capgemini_logo.svg" class="no-border" width="300"/>

        [@malcomio](https://twitter.com/malcomio)

        https://malcomio.github.io/presentations/code-review

        <aside class="notes">
          Large teams, small teams, even solo workers
          I'm not going to give you all the answers in this talk, but hopefully I'll help you ask the right questions
          Invite questions as we go, time at end
          First question is a basic one...
        </aside>
      </script>
    </section>

    <section data-markdown>
      <script type="text/template">
        ## What is Code Review?

        <img src="images/wtfm.jpg" class="fragment"/>

        <aside class="notes">
          Once upon a time, it meant a meeting where the team would sit and read code together line by line, either printed out or on screen
          Fagan inspection
          Most blog posts on the subject use this cartoon, so who am I to go against tradition?
          Sounds pretty tedious, right?
        </aside>
      </script>
    </section>

    <section data-markdown>
      <script type="text/template">
        ## Pull Requests

        <img src="images/joomla.jpg" class="fragment"/>

        <p class="fragment">https://www.atlassian.com/git/tutorials/comparing-workflows</p>
        <aside class="notes">
          These days, it doesn't have to be like that
          Git - create a branch, commit some changes, create a pull request
          See the changes and review them
          Joomla image at Drupal event
          Atlassian - info on different Git workflows
          Before I go further, I want to say thank you to this man.
        </aside>
      </script>
    </section>

    <section class="no-border">
      <table>
      <tr>
      <td><img src="images/alex_pott.jpg" /></td>
      </tr>
      <tr>
      <td class="text-center"><h2>Thanks Alex</h2></td>
    </tr>
    <tr>
    <td></td>
    </tr>
    </table>
    <aside class="notes">
      In the Drupal community, there are a lot of reasons to say thanks to Alex Pott.<br/>
      Having worked with him a few years ago at Capgemini, he's had a big influence, especially relating to code review <br/>
      He pushed for our team to make code review part of our process<br/>
      He also set a high standard -  <br/>
      Not everyone is lucky enough to work with people like Alex, but<br/>
      Now as a core maintainer, he does even more code review.
    </aside>
    </section>

    <section data-markdown data-background-image="images/why.jpg" data-background-color="#fff">
      <script type="text/template">
        <p>&nbsp;</p>

        <aside class="notes">
          Isn't it just a waste of time?
          Project manager breathing down your neck, need to get features out of the door on time
          keep client happy
          We're all competent developers, aren't we?
        </aside>
      </script>
    </section>

    <section  data-markdown>
      <script type="text/template">
        <blockquote>one who makes no mistakes makes nothing</blockquote>
        Giacomo Casanova

        <aside class="notes">
          Everybody makes mistakes
          Even Alex
          No matter how senior you are, how much experience you have,
          Even if you're working on your own, it's useful to review your code
          Diff before commit
          Looking at the difference in a different context can help you to see it in a new light, and spot potential problems
          Not reviewing code is a false economy
          Any manager who says it isn't good value - show them this graph
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/code-reviews.png"
      data-background-size="contain"
      class="text-on-light"
    >
      <script type="text/template">
        ## Prevent bugs

        <aside class="notes">
          2 Graphs from large project a few years ago
          SVN - code review coverage
          Direct correlation between increase in code review and decrease in bugs reported
          If you care about quality, you should be doing code review
          IMO, almost as important as testing
          Spot and fix problems before they go live, improve team efficiency
          Happy clients
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/spaghetti.jpg"
      class="text-on-light"
    >
      <script type="text/template">
        ## Improve maintainability

        <aside class="notes">
          Long term projects - cost of maintenance will outweigh cost of build
          Your future self will thank you, and so will colleagues
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/learning.jpg"
    >
      <script type="text/template">
        <p>&nbsp;</p>

        <aside class="notes">
          Other big reason for doing code review is what you learn
          Along with pair programming, it's a great learning resource
          Other people's code, other people's opinions on code
          Everyone has something to contribute
          code review isn't a one way street, with seniors telling juniors how it should be done
          Suggestions for improvements
          Better ways of doing things
          I've learned so much from code reviews, thanks to colleagues, senior and junior
        </aside>
      </script>
    </section>

    <section data-markdown data-background-image="images/how.jpg">
      <script type="text/template">
        <p>&nbsp;</p>
        <aside class="notes">
          Hopefully I've convinced you that it's worth doing code review
          So how do you do it?
        </aside>
      </script>
    </section>

    <section data-markdown data-background-color="#fff">
      <script type="text/template">
        ## Tools for the job

        <table class="no-border text-center">
          <tr class="fragment">
            <td><img class="no-border" src="images/GitHub_Logo.png"/></td>
            <td><img class="no-border" src="images/bitbucket_rgb_blue.png"/></td>
          </tr>
          <tr class="fragment">
            <td colspan="2"><img src="images/approved.png"/></td>
          </tr>
        </table>


        <aside class="notes">
          Git branching
          Approvals
          Team shares responsibility for quality
          Can't just blame an individual
          Set tasks
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/binoculars.jpg"
      class="text-on-light"
    >
      <script type="text/template">
        <h2>What Are We Looking For?</h2>
        <ul class="fragment">
          <li>Will It Work?</li>
          <li class="fragment">Security</li>
          <li class="fragment">Performance</li>
          <li class="fragment">Accessibility</li>
          <li class="fragment">Maintainability</li>
        </ul>
        <aside class="notes">
          Some of the points in this talk are specific to Drupal, others less so
          Will it work - specific to your project, so I can't say much on that
          Are you actually meeting the requirements?
          Edge cases?
          Don't be afraid to check out the branch in your local environment and test it
          Lullabot built Tugboat to spin up test environment for every pull request
          Are you making yourself vulnerable?
          Are you making the site slower?
          Are you causing problems for some of your users?
          Are you causing problems for your team in the future?
        </aside>
      </script>
    </section>

    <section data-markdown data-background-image="images/security.jpg">
      <script type="text/template">
        <p>&nbsp;</p>
        <aside class="notes">
          I don't claim to be an expert, but a few rules of thumb...
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/trust_no_one.jpg"
      class="text-on-light">
      <script type="text/template">
        <h2 class="fragment">Never Trust User Input</h2>
        <p class="fragment">Sanitise Everything</p>
        <p class="fragment">
          [drupal.org/docs/7/security/writing-secure-code](https://www.drupal.org/docs/7/security/writing-secure-code)
          [drupal.org/docs/8/security/writing-secure-code-for-drupal-8](https://www.drupal.org/docs/8/security/writing-secure-code-for-drupal-8)
        </p>

        <aside class="notes">
          XSS - if an attacker can execute JS or SQL injection, they can own your site
          What sort of data are we getting from users?
          Is it sensitive data?
          How and where are we storing and transmitting user data?
          Do we need to encrypt it?
        </aside>
      </script>
    </section>

    <section data-markdown data-background-image="images/speedometer.jpg" class="text-on-light" data-autoslide="1500" data-transition="fade-in">
      <script type="text/template">
        <h2 class="fragment" data-autoslide="0">Performance</h2>
        <p class="fragment">Unnecessary sessions?</p>
        <p class="fragment">Caching</p>
        <p class="fragment">Inefficient loops</p>
        <p class="fragment"></p>
        <aside class="notes">
          Try to minimise the work that the web server does
          Keep things cachable as much as possible
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/accessibility.jpg"
      class="text-on-light"
    >
      <script type="text/template">
        <h2>Accessibility</h2>

        <p class="fragment">Keyboard users</p>
        <p class="fragment">Hiding text appropriately?</p>
        <p class="fragment">Hover and focus</p>
        <p class="fragment">http://a11yproject.com/checklist.html</p>

        <aside class="notes">
          Getting accessibility right is difficult.
          Knowing how to apply appropriate ARIA roles takes time and energy.
          But you can get a long way with a few basic rules of thumb.
        </aside>
      </script>
    </section>

    <section data-markdown data-background-image="images/men_at_work.jpg" class="text-on-light">
      <script type="text/template">
        <h2 class="fragment">Maintainability</h2>
        <p class="fragment">Reinventing the wheel</p>
        <p class="fragment">Appropriate API usage</p>
        <p class="fragment">Unit test coverage</p>
        <p class="fragment">Comments</p>

        <aside class="notes">

          Enough comments? Too many comments can sometimes become noise
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/dogs.jpg"
      class="text-on-light"
    >
      <script type="text/template">
        <h2>Code smells</h2>
        <p class="fragment">
          Larry Garfield at DrupalCon London 2011
          https://www.youtube.com/watch?v=Z78ZP_UtaKE
        </p>
        <ul class="fragment">
          <li>And</li>
          <li class="fragment">Or</li>
          <li class="fragment">If</li>
          <li class="fragment">Testability</li>
          <li class="fragment">Documentation</li>
          <li class="fragment">Tight Coupling</li>
          <li class="fragment">Impurity</li>
        </ul>

        <aside class="notes">
          What is a code smell?
          A sign of possible problems.
          Not rules, but guidelines
          These ideas are also applicable to other languages
          I learned from Larry in Croydon - 7 common code smells
          And - Functions that do too much
          Or - functions that sometimes do different things
          If - excessive complexity
          Testability - can it be tested? if not, bad sign
          Docs - comments
          Tight Coupling - dependent on other parts of system
          Impurity - side effects plus return values
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/custom.jpg"
      class="text-on-light"
    >
      <script type="text/template">
        ## Custom v contrib

        <aside class="notes">
          Drupal people often say "There's a module for that"
          But is it appropriate?
          When you add contrib modules, review them like you'd review custom code
          Often the contrib module is like a Swiss Army knife - multipurpose, but not optimised for your specific use case
          Maybe you just want a simple, efficient tool
          When you review custom code, should a contrib module be used instead?
          Should the custom module be made generic, and contributed?
          We try to do this where possible at Capgemini - Stomp, Route
        </aside>
      </script>
    </section>

    <section data-markdown data-background-image="images/speak_your_mind.jpg">
      <script type="text/template">
        <p>&nbsp;</p>
        <aside class="notes">
          A few points about the way to do code reviews
          If you see a problem, speak up
          Don't keep quiet because you're junior or unconfident
          If you don't understand what a piece of code is doing, it probably says more about the code than it does about you
          Be frank, open and honest
        </aside>
      </script>
    </section>

    <section data-markdown data-background-image="images/statler.jpg" class="text-on-light">
      <script type="text/template">
        <h2 class="fragment">Don't make it personal</h2>
        <aside class="notes">
          We're reviewing the code, not the coder
          We all make mistakes - that's how we learn
          Writing bad code doesn't make you a bad person
          Code review isn't a competition - not a chance to snipe at each other
          You're a team - support each other
          Help colleagues improve - share links, ideas
          Don't just tell people when they're doing something wrong - point to examples of good code
          Get everyone involved - we can all learn from each other
          How your team behaves towards each other is as important as the quality of the work
          Remember that your colleagues are human
        </aside>
      </script>
    </section>

    <section
      data-markdown
      data-background-image="images/automate.jpg"
      data-background-size="contain"
      data-background-color="#FFF"
      class="text-on-light">
      <script type="text/template">
        <p class="fragment">Set up your IDE:<br/>https://www.drupal.org/docs/develop/development-tools</p>
        <p class="fragment">Pre-commit hooks:<br/>https://github.com/geraldvillorente/drupal-pre-commit</p>
        <p class="fragment">Static analysis with Jenkins:<br/>http://reload.github.io/jenkins-drupal-template/</p>
        <aside class="notes">
          I'm a big coding standards pedant - improve signal to noise in dev and code review
          But adding comments about whitespace is pretty tedious
          So get machines to do the boring work for you
          appropriate level depends on size of your team
          Integrate PHPCodeSniffer with your IDE
          Pre-commit hooks
          Integrate your CI server with your pull requests
          If it breaks coding standards, the code doesn't get merged
          If the unit tests fail, the code doesn't get merged
          If it is horrendously complex, the code doesn't get merged
        </aside>
      </script>
    </section>

    <section
      data-background-image="images/haystacks.jpg"
      class="text-on-light"
    >
      <h2 class="fragment">Small is Beautiful</h2>
      <div class="fragment text-center no-background">
        <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">10 lines of code = 10 issues.<br>500 lines of code = &quot;looks fine&quot;.<br>Code reviews.</p>&mdash; Michal Konturek (@MichalKonturek) <a href="https://twitter.com/MichalKonturek/status/612867076718526464">June 22, 2015</a></blockquote>
        <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
        <aside class="notes">
          Not so much about the review itself, but about the pull request.<br/>
          In the same way that long functions are a code smell, so are big pull requests<br/>
          Branching is easy with Git - if it's a big feature, create a feature branch, and review the code as it's being merged into that branch  <br/>
          If you wait until the feature is ready to merge into your main branch, reviewing it will be a nightmare    <br/>
          Watch out for attention fatigue - it's difficult to review large changes<br/>
          If you give people too much information, they'll struggle.  <br/>
          Cognitive load of reviewing large change means reviewers are less likely to spot problems.<br/>
          Code review requires concentration, and it's difficult to concentrate for a long time.  <br/>
          And that seems like an appropriate place to finish.
        </aside>
    </section>

    <section>
      <h2>Image credits</h2>
      <div class="split-screen three-column">
        <a href="http://www.osnews.com/story/19266/WTFs_m">WTFs per minute</a>
        <a href="https://www.flickr.com/photos/hagengraf/6520777613">Pull request</a>
        <a href="https://www.flickr.com/photos/ksayer/5614813544">Why</a>
        <a href="http://www.tsphethean.co.uk/blog/2013/11/28/Reviewing-code-reviews/">Defect Graphs</a>
        <a href="https://www.flickr.com/photos/stevendepolo/15817264281">Spaghetti</a>
        <a href="https://www.flickr.com/photos/cogdog/15905754123">Learning</a>
        <a href="https://twitter.com/pdjohnson/status/781489468008194049">Alex Pott</a>
        <a href="https://www.flickr.com/photos/sabertasche2/2609405516">How</a>
        <a href="https://www.flickr.com/photos/cloresinparadise/3382640460">Binoculars</a>
        <a href="https://pixabay.com/en/police-security-safety-protection-869216/">Security</a>
        <a href="https://www.flickr.com/photos/lynnfriedman/6278971615">Trust No One</a>
        <a href="https://www.flickr.com/photos/hadamsky/293346840">Speedometer</a>
        <a href="https://www.flickr.com/photos/otrops/4716966580">Accessibility</a>
        <a href="https://www.flickr.com/photos/16210667@N02/9172895225">Men at Work</a>
        <a href="https://www.flickr.com/photos/steve-wilson/458703692">Dogs</a>
        <a href="https://www.flickr.com/photos/wfryer/3242288624">Speak Your Mind</a>
        <a href="https://commons.wikimedia.org/wiki/File:Waldorf_Statler_Wall_Painting.jpg">Statler & Waldorf</a>
        <a href="https://memegenerator.net/instance/9449708">Automate</a>
        <a href="https://commons.wikimedia.org/wiki/File:Custom_Car_Abandoned.jpg">Custom</a>
        <a href="https://commons.wikimedia.org/wiki/File:Hay_cocks_-_geograph.org.uk_-_1439469.jpg">Haystacks</a>
      </div>
    </section>

    <section data-markdown>
      <script type="text/template">
        ## Further Reading
        [Better Learning Through Code Reviews](https://capgemini.github.io/learning/better-learning-code-reviews/)

        [What To Look For In A Code Review](https://capgemini.github.io/drupal/what-to-look-for-in-code-review/)
      </script>
    </section>

    <section data-markdown data-background-color="#fff">
      <script type="text/template">
        <img src="../images/capgemini_logo.svg" class="no-border"/>
        https://capgemini.github.io

        https://malcomio.github.io/presentations/code-review

        [@malcomio](https://twitter.com/malcomio)

        <aside class="notes">

        </aside>
      </script>
    </section>
  </div>

</div>

<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>

<script>

  // More info https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: false,
    progress: false,
    history: true,
    center: true,
    showNotes: print,
    slideNumber: 'c/t',

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // More info https://github.com/hakimel/reveal.js#dependencies
    dependencies: [
      {
        src: '../lib/js/classList.js',
        condition: function () {
          return !document.body.classList;
        }
      },
      {
        src: '../plugin/markdown/marked.js',
        condition: function () {
          return !!document.querySelector('[data-markdown]');
        }
      },
      {
        src: '../plugin/markdown/markdown.js',
        condition: function () {
          return !!document.querySelector('[data-markdown]');
        }
      },
      {
        src: '../plugin/highlight/highlight.js',
        async: true,
        callback: function () {
          hljs.initHighlightingOnLoad();
        }
      },
      {
        src: '../plugin/zoom-js/zoom.js',
        async: true
      },
      {
        src: '../plugin/notes/notes.js',
        async: true
      }
    ]
  });

</script>

</body>
</html>
